
<!DOCTYPE html>
<html>
<head>
  <title>Weekly Pay Tracker with Login and PDF</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 4px;
      text-align: center;
    }
    input[type='number'] { width: 60px; }
    textarea { width: 100%; height: 50px; }
  </style>
</head>
<body>
  <h1>Weekly Pay Tracker</h1>
  <div id="authSection">
    <h2>Login or Register</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
    <p id="authMessage"></p>
  </div>

  <div id="trackerSection" style="display:none;">
    <h2>Enter Hours (Monâ€“Sun)</h2>
    <label>Pay Period Start (DD/MM/YY): <input type="text" id="payPeriod"></label>
    <table>
      <thead>
        <tr>
          <th>Pay Rate</th>
          <th>Monday</th>
          <th>Tuesday</th>
          <th>Wednesday</th>
          <th>Thursday</th>
          <th>Friday</th>
          <th>Saturday</th>
          <th>Sunday</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Base ($13.28)</td>
          <td><input type="number" id="mon_base"></td>
          <td><input type="number" id="tue_base"></td>
          <td><input type="number" id="wed_base"></td>
          <td><input type="number" id="thu_base"></td>
          <td><input type="number" id="fri_base"></td>
          <td><input type="number" id="sat_base"></td>
          <td><input type="number" id="sun_base"></td>
        </tr>
        <tr>
          <td>After 6pm ($16.60)</td>
          <td><input type="number" id="mon_evening"></td>
          <td><input type="number" id="tue_evening"></td>
          <td><input type="number" id="wed_evening"></td>
          <td><input type="number" id="thu_evening"></td>
          <td><input type="number" id="fri_evening"></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>Saturday ($16.60)</td>
          <td></td><td></td><td></td><td></td><td></td>
          <td><input type="number" id="sat_saturday"></td><td></td>
        </tr>
        <tr>
          <td>Sunday ($19.92)</td>
          <td></td><td></td><td></td><td></td><td></td><td></td>
          <td><input type="number" id="sun_sunday"></td>
        </tr>
      </tbody>
    </table>
    <br>
    <label>Notes: <textarea id="weekNotes"></textarea></label>
    <br><br>
    <button onclick="addWeekEntry()">Submit Week</button>
    <button onclick="logout()">Logout</button>
    <button onclick="generatePDF()">Download PDF</button>

    <h3>Weekly History</h3>
    <ul id="history"></ul>
    <h3>Average Weekly Total: $<span id="average">0.00</span></h3>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBOMK1trQZ5Ybaq11f6nx7_L1_vsdhvQnA",
      authDomain: "pay-tracker-d6145.firebaseapp.com",
      projectId: "pay-tracker-d6145",
      storageBucket: "pay-tracker-d6145.firebasestorage.app",
      messagingSenderId: "915657691207",
      appId: "1:915657691207:web:d13bacb0e6044df875e162",
      measurementId: "G-EE1G4QRWQV"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUser = null;

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById("authSection").style.display = "none";
        document.getElementById("trackerSection").style.display = "block";
        loadHistory();
      } else {
        currentUser = null;
        document.getElementById("authSection").style.display = "block";
        document.getElementById("trackerSection").style.display = "none";
      }
    });

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(err => document.getElementById("authMessage").innerText = err.message);
    }

    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .catch(err => document.getElementById("authMessage").innerText = err.message);
    }

    function logout() {
      auth.signOut();
    }

    function getInput(id) {
      return parseFloat(document.getElementById(id)?.value || 0);
    }

    function addWeekEntry() {
      const rate = { base: 13.28, evening: 16.60, saturday: 16.60, sunday: 19.92 };
      const days = ["mon", "tue", "wed", "thu", "fri", "sat", "sun"];
      let total = 0;

      for (const day of days) {
        let base = getInput(`${day}_base`);
        let evening = getInput(`${day}_evening`);
        let sat = day === "sat" ? getInput(`sat_saturday`) : 0;
        let sun = day === "sun" ? getInput(`sun_sunday`) : 0;
        let dailyHours = base + evening + sat + sun;
        let breakTime = dailyHours >= 6 ? 0.5 : 0;
        dailyHours -= breakTime;

        total += base * rate.base;
        total += evening * rate.evening;
        total += sat * rate.saturday;
        total += sun * rate.sunday;
      }

      db.collection("users").doc(currentUser.uid).collection("entries").add({
        total,
        timestamp: new Date(),
        notes: document.getElementById("weekNotes").value,
        payPeriod: document.getElementById("payPeriod").value
      }).then(loadHistory);
    }

    function loadHistory() {
      db.collection("users").doc(currentUser.uid).collection("entries")
        .orderBy("timestamp", "desc").get().then(snapshot => {
          const list = document.getElementById("history");
          list.innerHTML = "";
          let total = 0, count = 0;
          snapshot.forEach(doc => {
            const amount = doc.data().total;
            total += amount;
            count++;
            const li = document.createElement("li");
            li.textContent = `$${amount.toFixed(2)} - ${doc.data().payPeriod || ''}`;
            list.appendChild(li);
          });
          document.getElementById("average").innerText = (total / count || 0).toFixed(2);
        });
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
      const inputId = ["mon", "tue", "wed", "thu", "fri", "sat", "sun"];
      const notes = document.getElementById("weekNotes").value;
      const payPeriod = document.getElementById("payPeriod").value;

      doc.setFontSize(14);
      doc.text("Weekly Pay Summary", 20, 20);
      doc.setFontSize(10);
      doc.text(`Pay Period: ${payPeriod}`, 20, 28);
      doc.text(`Notes: ${notes}`, 20, 36);

      let y = 50;
      doc.text("Day        Hours        Break Deducted", 20, y);
      y += 8;

      for (let i = 0; i < 7; i++) {
        const base = getInput(`${inputId[i]}_base`);
        const evening = getInput(`${inputId[i]}_evening`);
        const sat = inputId[i] === "sat" ? getInput(`sat_saturday`) : 0;
        const sun = inputId[i] === "sun" ? getInput(`sun_sunday`) : 0;
        let totalHours = base + evening + sat + sun;
        const breakApplied = totalHours >= 6 ? 0.5 : 0;
        totalHours -= breakApplied;
        doc.text(`${days[i]}        ${totalHours.toFixed(2)} hrs        ${breakApplied > 0 ? "0.5 hr" : "-"}`, 20, y);
        y += 8;
      }

      doc.save("weekly_summary.pdf");
    }
  </script>
</body>
</html>

