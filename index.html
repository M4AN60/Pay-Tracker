<!DOCTYPE html>
<html>
<head>
  <title>Pay Tracker with Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Pay Tracker</h1>

  <!-- Login/Register Section -->
  <div id="authSection">
    <h2>Login or Register</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
    <p id="authMessage" style="color: red;"></p>
  </div>

  <!-- Tracker Section -->
  <div id="trackerSection" style="display:none;">
    <h2>Enter Your Hours</h2>
    Base Hours ($13.28): <input type="number" id="baseHours" step="0.01"><br>
    After 6pm Hours ($16.60): <input type="number" id="eveningHours" step="0.01"><br>
    Saturday Hours ($16.60): <input type="number" id="saturdayHours" step="0.01"><br>
    Sunday Hours ($19.92): <input type="number" id="sundayHours" step="0.01"><br>
    <button onclick="addEntry()">Add Entry</button>
    <button onclick="logout()">Logout</button>

    <h3>History</h3>
    <ul id="history"></ul>
    <h3>Weekly Average: $<span id="average">0.00</span></h3>
  </div>

  <script>
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBOMK1trQZ5Ybaq11f6nx7_L1_vsdhvQnA",
  authDomain: "pay-tracker-d6145.firebaseapp.com",
  projectId: "pay-tracker-d6145",
  storageBucket: "pay-tracker-d6145.firebasestorage.app",
  messagingSenderId: "915657691207",
  appId: "1:915657691207:web:d13bacb0e6044df875e162",
  measurementId: "G-EE1G4QRWQV"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUser = null;

    // Auth State Listener
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById("authSection").style.display = "none";
        document.getElementById("trackerSection").style.display = "block";
        loadHistory();
      } else {
        currentUser = null;
        document.getElementById("authSection").style.display = "block";
        document.getElementById("trackerSection").style.display = "none";
      }
    });

    // Register
    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .catch(err => document.getElementById("authMessage").innerText = err.message);
    }

    // Login
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(err => document.getElementById("authMessage").innerText = err.message);
    }

    // Logout
    function logout() {
      auth.signOut();
    }

    // Add Entry
    function addEntry() {
      const base = parseFloat(document.getElementById('baseHours').value || 0) * 13.28;
      const evening = parseFloat(document.getElementById('eveningHours').value || 0) * 16.60;
      const saturday = parseFloat(document.getElementById('saturdayHours').value || 0) * 16.60;
      const sunday = parseFloat(document.getElementById('sundayHours').value || 0) * 19.92;
      const total = base + evening + saturday + sunday;

      db.collection("users").doc(currentUser.uid).collection("entries").add({
        amount: total,
        timestamp: new Date()
      }).then(() => {
        loadHistory();
        // Reset form
        document.getElementById('baseHours').value = '';
        document.getElementById('eveningHours').value = '';
        document.getElementById('saturdayHours').value = '';
        document.getElementById('sundayHours').value = '';
      });
    }

    // Load History
    function loadHistory() {
      db.collection("users").doc(currentUser.uid).collection("entries")
        .orderBy("timestamp", "desc")
        .get()
        .then(snapshot => {
          const historyList = document.getElementById("history");
          historyList.innerHTML = "";
          let total = 0;
          let count = 0;
          snapshot.forEach(doc => {
            const entry = doc.data().amount;
            total += entry;
            count++;
            const li = document.createElement("li");
            li.textContent = `$${entry.toFixed(2)}`;
            historyList.appendChild(li);
          });
          const avg = (count > 0) ? (total / count).toFixed(2) : "0.00";
          document.getElementById("average").innerText = avg;
        });
    }
  </script>
</body>
</html>
